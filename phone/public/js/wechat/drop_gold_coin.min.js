(function(){var a=function(b){this.items=this.extend({img:"/images/wechat/mod/coin.png",boomimg:"/images/wechat/mod/boomcoin.png",trigger:"dropGoldCoinBox",goldCoinDiv:"goldCoinDiv",size:50,goldCoinNum:1,numColor:"#FFD31D",offsetTop:0,autoTime:5000,showText:"+1 金币",callback:function(){},},b);this.inited=false;this.init()};a.prototype.init=function(){if(this.inited){console.log("init is already");return false}this.triggerElement=document.getElementById(this.items.trigger);if(!this.triggerElement){console.log("trigger not found");return false}this.boxElement=document.getElementById(this.items.goldCoinDiv);if(!this.boxElement){console.log("goldCoinDiv not found");return false}this.t=(new Date()).getTime()+parseInt(Math.random()*10000);this.stage=[0,0,0,0];this.gravity={x:0,y:1};this.elems=[];this.boomElems=[];this.goldNumBoxs=[];this.regClip=RegExp(/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/);this.ticking=false;this.droped=false;this.inited=true;var b=this;window.addEventListener("scroll",function(){b.tickingListener()},false);this.checkDropPoint()};a.prototype.extend=function(b,c){for(var d in c){if(c.hasOwnProperty(d)){b[d]=c[d]}}return b};a.prototype.tickingListener=function(){if(!this.droped&&!this.ticking){this.ticking=true;var b=this;window.requestAnimationFrame(function(){b.checkDropPoint()})}};a.prototype.checkDropPoint=function(){if(window.scrollY>this.triggerElement.offsetTop){this.droped=true;this.drop()}this.ticking=false};a.prototype.drop=function(){var c=this;for(var d=0;d<this.items.goldCoinNum;d++){var b=new Image();if(this.regClip.test(this.items.img)){b.crossOrigin="Anonymous"}b.src=this.items.img;b.done=false;b.style.width=this.items.size+"px";b.style.zIndex=3000;b.style.position="fixed";b.style.bottom=this.items.offsetTop+"px";this.tx=((Math.random()*(window.screen.availWidth-this.items.size*2))+10).toFixed(4);if(this.tx<20){this.tx=Number(this.tx)+this.items.size*2}b.style.left=this.tx+"px";b.style.transform="scale(0)";b.style.MsTransform="scale(0)";b.style.MozTransform="scale(0)";b.style.OTransform="scale(0)";b.style.WebkitTransform="scale(0)";b.idx=d;b.onload=function(){c.drawImage(this)};b.onerror=function(f){console.log(f)}}};a.prototype.drawImage=function(c){c.id="GoldCoin"+(new Date()).getTime()+"_"+parseInt(Math.random()*100000)+"_"+c.idx;this.boxElement.insertAdjacentElement("afterBegin",c);this.elems[c.idx]=document.getElementById(c.id);this.elems[c.idx].ended=false;this.elems[c.idx].className="showGoldCoin";this.boomElems[c.idx]=[];var b=this;this.elems[c.idx].onclick=function(){b.elems[c.idx].onclick=null;b.callback(c.idx)}};a.prototype.callback=function(c){var d=document.createElement("span");d.id="goldNumBox"+this.t+c;d.style.display="inline-block";d.style.opacity="0";d.style.color=this.items.numColor;d.style.width=this.items.size+"px";d.style.fontSize="14px";d.style.textAlign="center";d.style.position="fixed";d.style.left=this.tx+"px";d.style.bottom=(Number(this.items.offsetTop)+this.items.size/2)+"px";d.innerHTML=this.items.showText;this.boxElement.insertAdjacentElement("afterBegin",d);this.goldNumBoxs[c]=document.getElementById("goldNumBox"+this.t+c);this.elems[c].className="hideGoldCoin";this.goldNumBoxs[c].style.opacity="1";this.goldNumBoxs[c].className="showGoldNum";var b=this;this.goldNumBoxs[c].addEventListener("webkitAnimationEnd",function(){b.destroy(c)},false);this.goldNumBoxs[c].addEventListener("animationEnd",function(){b.destroy(c)},false);typeof this.items.callback=="function"&&this.items.callback()};a.prototype.destroy=function(b){if(!this.elems[b].ended){this.elems[b].ended=true;this.elems[b].parentNode.removeChild(this.elems[b]);this.goldNumBoxs[b].parentNode.removeChild(this.goldNumBoxs[b]);this.items.goldCoinNum--;if(this.items.goldCoinNum<=0){window.cancelAnimationFrame(this.animateId)}}};a.prototype.currentStyle=function(b){return(b.currentStyle?b.currentStyle:window.getComputedStyle(b,null))};window.GoldCoin=a})();